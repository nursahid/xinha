Xinha.Config.prototype.css_style={};Xinha.Config.prototype.stylistLoadStylesheet=function(a,d){if(!d){d={}}var c=Xinha.ripStylesFromCSSFile(a);for(var b in c){if(d[b]){this.css_style[b]=d[b]}else{this.css_style[b]=c[b]}}this.pageStyleSheets[this.pageStyleSheets.length]=a};Xinha.Config.prototype.stylistLoadStyles=function(b,d){if(!d){d={}}var c=Xinha.ripStylesFromCSSString(b);for(var a in c){if(d[a]){this.css_style[a]=d[a]}else{this.css_style[a]=c[a]}}this.pageStyle+=b};Xinha.prototype._fillStylist=function(){if(!this._stylist){return false}this.plugins.Stylist.instance.main.innerHTML="";var e=true;var a=this._getSelection();var h=this._activeElement(a);for(var k in this.config.css_style){var l=null;var j=k.trim();var c=true;var b=h;if(c&&/[^a-zA-Z0-9_.-]/.test(j)){c=false}if(j.indexOf(".")<0){c=false}if(c&&(j.indexOf(".")>0)){l=j.substring(0,j.indexOf(".")).toLowerCase();j=j.substring(j.indexOf("."),j.length);if(h!=null&&h.tagName.toLowerCase()==l){c=true;b=h}else{if(this._getFirstAncestor(this._getSelection(),[l])!=null){c=true;b=this._getFirstAncestor(this._getSelection(),[l])}else{if((l=="div"||l=="span"||l=="p"||(l.substr(0,1)=="h"&&l.length==2&&l!="hr"))){if(!this._selectionEmpty(this._getSelection())){c=true;b="new"}else{b=this._getFirstAncestor(a,["p","h1","h2","h3","h4","h5","h6","h7"]);if(b!=null){c=true}else{c=false}}}else{c=false}}}}if(c){j=j.substring(j.indexOf("."),j.length);j=j.replace("."," ");if(b==null){if(this._selectionEmpty(this._getSelection())){b=this._getFirstAncestor(this._getSelection(),null)}else{b="new";l="span"}}}var d=(this._ancestorsWithClasses(a,l,j).length>0?true:false);var f=this._ancestorsWithClasses(a,l,j);if(c){var i=document.createElement("a");i.onfocus=function(){this.blur()};i._stylist_className=j.trim();i._stylist_applied=d;i._stylist_appliedTo=f;i._stylist_applyTo=b;i._stylist_applyTag=l;i.innerHTML=this.config.css_style[k];i.href="javascript:void(0)";var g=this;i.onclick=function(){if(this._stylist_applied==true){g._stylistRemoveClasses(this._stylist_className,this._stylist_appliedTo)}else{g._stylistAddClasses(this._stylist_applyTo,this._stylist_applyTag,this._stylist_className)}return false};i.style.display="block";i.style.paddingLeft="3px";i.style.paddingTop="1px";i.style.paddingBottom="1px";i.style.textDecoration="none";if(d){i.style.background="Highlight";i.style.color="HighlightText"}this.plugins.Stylist.instance.main.appendChild(i)}}};Xinha.prototype._stylistAddClasses=function(c,a,b){if(c=="new"){this.insertHTML("<"+a+' class="'+b+'">'+this.getSelectedHTML()+"</"+a+">")}else{if(a!=null&&c.tagName.toLowerCase()!=a){var d=this.switchElementTag(c,a);if(typeof c._stylist_usedToBe!="undefined"){d._stylist_usedToBe=c._stylist_usedToBe;d._stylist_usedToBe[d._stylist_usedToBe.length]={tagName:c.tagName,className:c.getAttribute("class")}}else{d._stylist_usedToBe=[{tagName:c.tagName,className:c.getAttribute("class")}]}Xinha.addClasses(d,b)}else{Xinha._addClasses(c,b)}}this.focusEditor();this.updateToolbar()};Xinha.prototype._stylistRemoveClasses=function(b,c){for(var a=0;a<c.length;a++){this._stylistRemoveClassesFull(c[a],b)}this.focusEditor();this.updateToolbar()};Xinha.prototype._stylistRemoveClassesFull=function(a,c){if(a!=null){var e=a.className.trim().split(" ");var f=[];var m=c.split(" ");for(var j=0;j<e.length;j++){var l=false;for(var d=0;l==false&&d<m.length;d++){if(m[d]==e[j]){l=true}}if(l==false){f[f.length]=e[j]}}if(f.length==0&&a._stylist_usedToBe&&a._stylist_usedToBe.length>0&&a._stylist_usedToBe[a._stylist_usedToBe.length-1].className!=null){var h=a._stylist_usedToBe[a._stylist_usedToBe.length-1];var k=Xinha.arrayFilter(h.className.trim().split(" "),function(i){if(i==null||i.trim()==""){return false}return true});if((f.length==0)||(Xinha.arrayContainsArray(f,k)&&Xinha.arrayContainsArray(k,f))){a=this.switchElementTag(a,h.tagName);f=k}else{a._stylist_usedToBe=[]}}if(f.length>0||a.tagName.toLowerCase()!="span"||(a.id&&a.id!="")){a.className=f.join(" ").trim()}else{var b=a.parentNode;var g=a.childNodes;for(var j=0;j<g.length;j++){b.insertBefore(g[j],a)}b.removeChild(a)}}};Xinha.prototype.switchElementTag=function(d,b){var c=d.parentNode;var f=this._doc.createElement(b);if(Xinha.is_ie||d.hasAttribute("id")){f.setAttribute("id",d.getAttribute("id"))}if(Xinha.is_ie||d.hasAttribute("style")){f.setAttribute("style",d.getAttribute("style"))}var e=d.childNodes;for(var a=0;a<e.length;a++){f.appendChild(e[a].cloneNode(true))}c.insertBefore(f,d);f._stylist_usedToBe=[d.tagName];c.removeChild(d);this.selectNodeContents(f);return f};Xinha.prototype._getAncestorsClassNames=function(d){var c=this._activeElement(d);if(c==null){c=(Xinha.is_ie?this._createRange(d).parentElement():this._createRange(d).commonAncestorContainer)}var e=[];while(c){if(c.nodeType==1){var b=c.className.trim().split(" ");for(var a=0;a<b.length;a++){e[e.length]=b[a]}if(c.tagName.toLowerCase()=="body"){break}if(c.tagName.toLowerCase()=="table"){break}}c=c.parentNode}return e};Xinha.prototype._ancestorsWithClasses=function(a,m,c){var l=[];var b=this._activeElement(a);if(b==null){try{b=(Xinha.is_ie?this._createRange(a).parentElement():this._createRange(a).commonAncestorContainer)}catch(h){return l}}var g=c.trim().split(" ");while(b){if(b.nodeType==1&&b.className){if(m==null||b.tagName.toLowerCase()==m){var c=b.className.trim().split(" ");var k=true;for(var f=0;f<g.length;f++){var d=false;for(var j=0;j<c.length;j++){if(g[f]==c[j]){d=true;break}}if(!d){k=false;break}}if(k){l[l.length]=b}}if(b.tagName.toLowerCase()=="body"){break}if(b.tagName.toLowerCase()=="table"){break}}b=b.parentNode}return l};Xinha.ripStylesFromCSSFile=function(a){var b=Xinha._geturlcontent(a);return Xinha.ripStylesFromCSSString(b)};Xinha.ripStylesFromCSSString=function(c){RE_comment=/\/\*(.|\r|\n)*?\*\//g;RE_rule=/\{(.|\r|\n)*?\}/g;c=c.replace(RE_comment,"");c=c.replace(RE_rule,",");c=c.split(",");var b={};for(var a=0;a<c.length;a++){if(c[a].trim()){b[c[a].trim()]=c[a].trim()}}return b};function Stylist(b,a){this.editor=b;var c=this}Stylist._pluginInfo={name:"Stylist",version:"1.0",developer:"James Sleeman",developer_url:"http://www.gogo.co.nz/",c_owner:"Gogo Internet Services",license:"HTMLArea",sponsor:"Gogo Internet Services",sponsor_url:"http://www.gogo.co.nz/"};Stylist.prototype.onGenerateOnce=function(){var a=this.editor;var b=this;if(typeof a.config.css_style!="undefined"&&Xinha.objectProperties(a.config.css_style).length!=0){a._stylist=null;a._stylist=a.addPanel("right");Xinha.addClass(a._stylist,"stylist");this.caption=document.createElement("h1");this.caption.innerHTML=Xinha._lc("Styles","Stylist");a._stylist.appendChild(this.caption);this.main=document.createElement("div");this.main.style.overflow="auto";this.main.style.height=this.editor._framework.ed_cell.offsetHeight-this.caption.offsetHeight+"px";a._stylist.appendChild(this.main);Xinha.freeLater(this,"caption");Xinha.freeLater(this,"main");a.notifyOn("modechange",function(d,c){switch(c.mode){case"text":a.hidePanel(a._stylist);break;case"wysiwyg":a.showPanel(a._stylist);break}});a.notifyOn("panel_change",function(f,d){switch(d.action){case"show":var c=b.main.offsetHeight-d.panel.offsetHeight;b.main.style.height=((c>0)?b.main.offsetHeight-d.panel.offsetHeight:0)+"px";a._stylist.style.height=b.caption.offsetHeight+"px";a.sizeEditor();break;case"hide":b.resize();break}});a.notifyOn("before_resize",function(){a._stylist.style.height=b.caption.offsetHeight+"px"});a.notifyOn("resize",function(){b.resize()})}};Stylist.prototype.resize=function(){var d=this.editor;var c=d._stylist.parentNode;var a=c.offsetHeight;for(var b=0;b<c.childNodes.length;++b){if(c.childNodes[b]==d._stylist||!c.childNodes[b].offsetHeight){continue}a-=c.childNodes[b].offsetHeight}d._stylist.style.height=a+"px";this.main.style.height=a-this.caption.offsetHeight+"px"};Stylist.prototype.onUpdateToolbar=function(){if(this.editor._stylist){if(this._timeoutID){window.clearTimeout(this._timeoutID)}var a=this.editor;this._timeoutID=window.setTimeout(function(){a._fillStylist()},250)}};