ColorPicker._pluginInfo={name:"colorPicker",version:"1.0",developer:"James Sleeman",developer_url:"http://www.gogo.co.nz/",c_owner:"Gogo Internet Services",license:"htmlArea",sponsor:"Gogo Internet Services",sponsor_url:"http://www.gogo.co.nz/"};function ColorPicker(){}if(window.opener&&window.opener.Xinha){var openerColorPicker=window.opener.Xinha.colorPicker;Xinha._addEvent(window,"unload",function(){Xinha.colorPicker=openerColorPicker})}Xinha.colorPicker=function(s){if(Xinha.colorPicker.savedColors.length===0){Xinha.colorPicker.loadColors()}this.is_ie_6=(Xinha.is_ie&&Xinha.ie_version<7);var h=this;var c=false;var d=false;var v=0;var t=0;this.callback=s.callback?s.callback:function(w){alert("You picked "+w)};this.websafe=s.websafe?s.websafe:false;this.savecolors=s.savecolors?s.savecolors:20;this.cellsize=parseInt(s.cellsize?s.cellsize:"10px",10);this.side=s.granularity?s.granularity:18;var g=this.side+1;var j=this.side-1;this.value=1;this.saved_cells=null;this.table=document.createElement("table");this.table.className="dialog";this.table.cellSpacing=this.table.cellPadding=0;this.table.onmouseup=function(){c=false;d=false};this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.table.style.border="1px solid WindowFrame";this.table.style.zIndex="1050";var b=document.createElement("tr");var f=document.createElement("td");f.colSpan=this.side;f.className="title";f.style.fontFamily="small-caption,caption,sans-serif";f.style.fontSize="x-small";f.unselectable="on";f.style.MozUserSelect="none";f.style.cursor="default";f.appendChild(document.createTextNode(Xinha._lc("Click a color...")));f.style.borderBottom="1px solid WindowFrame";b.appendChild(f);f=null;var f=document.createElement("td");f.className="title";f.colSpan=2;f.style.fontFamily="Tahoma,Verdana,sans-serif";f.style.borderBottom="1px solid WindowFrame";f.style.paddingRight="0";b.appendChild(f);var l=document.createElement("div");l.title=Xinha._lc("Close");l.className="buttonColor";l.style.height="11px";l.style.width="11px";l.style.cursor="pointer";l.onclick=function(){h.close()};l.appendChild(document.createTextNode("\u00D7"));l.align="center";l.style.verticalAlign="top";l.style.position="relative";l.style.cssFloat="right";l.style.styleFloat="right";l.style.padding="0";l.style.margin="2px";l.style.backgroundColor="transparent";l.style.fontSize="11px";if(!Xinha.is_ie){l.style.lineHeight="9px"}l.style.letterSpacing="0";f.appendChild(l);this.tbody.appendChild(b);l=b=f=null;this.constrain_cb=document.createElement("input");this.constrain_cb.type="checkbox";this.chosenColor=document.createElement("input");this.chosenColor.type="text";this.chosenColor.maxLength=7;this.chosenColor.style.width="50px";this.chosenColor.style.fontSize="11px";this.chosenColor.onchange=function(){if(/#[0-9a-f]{6,6}/i.test(this.value)){h.backSample.style.backgroundColor=this.value;h.foreSample.style.color=this.value}};this.backSample=document.createElement("div");this.backSample.appendChild(document.createTextNode("\u00A0"));this.backSample.style.fontWeight="bold";this.backSample.style.fontFamily="small-caption,caption,sans-serif";this.backSample.fontSize="x-small";this.foreSample=document.createElement("div");this.foreSample.appendChild(document.createTextNode(Xinha._lc("Sample")));this.foreSample.style.fontWeight="bold";this.foreSample.style.fontFamily="small-caption,caption,sans-serif";this.foreSample.fontSize="x-small";function p(x){var w=x.toString(16);if(w.length<2){w="0"+w}return w}function o(w){return"#"+p(w.red)+p(w.green)+p(w.blue)}function u(w,x){return Math.round(Math.round(w/x)*x)}function e(w){return parseInt(w.toString(16)+w.toString(16),16)}function r(w){w.red=e(u(parseInt(p(w.red).charAt(0),16),3));w.blue=e(u(parseInt(p(w.blue).charAt(0),16),3));w.green=e(u(parseInt(p(w.green).charAt(0),16),3));return w}function k(A,E,C){var w;if(E===0){w={red:C,green:C,blue:C}}else{A/=60;var z=Math.floor(A);var B=A-z;var y=C*(1-E);var x=C*(1-E*B);var D=C*(1-E*(1-B));switch(z){case 0:w={red:C,green:D,blue:y};break;case 1:w={red:x,green:C,blue:y};break;case 2:w={red:y,green:C,blue:D};break;case 3:w={red:y,green:x,blue:C};break;case 4:w={red:D,green:y,blue:C};break;default:w={red:C,green:y,blue:x};break}}w.red=Math.ceil(w.red*255);w.green=Math.ceil(w.green*255);w.blue=Math.ceil(w.blue*255);return w}var n=this;function a(w){w=w?w:window.event;el=w.target?w.target:w.srcElement;do{if(el==n.table){return}}while(el=el.parentNode);n.close()}this.open=function(F,z,A){this.table.style.display="";this.pick_color();if(A&&/#[0-9a-f]{6,6}/i.test(A)){this.chosenColor.value=A;this.backSample.style.backgroundColor=A;this.foreSample.style.color=A}Xinha._addEvent(document.body,"mousedown",a);this.table.style.position="absolute";var D=z;var C=0;var B=0;do{if(D.style.position=="fixed"){this.table.style.position="fixed"}C+=D.offsetTop;B+=D.offsetLeft;D=D.offsetParent}while(D);var w,E;if(/top/.test(F)||(C+this.table.offsetHeight>document.body.offsetHeight)){if(C-this.table.offsetHeight>0){this.table.style.top=(C-this.table.offsetHeight)+"px"}else{this.table.style.top=0}}else{this.table.style.top=(C+z.offsetHeight)+"px"}if(/left/.test(F)||(B+this.table.offsetWidth>document.body.offsetWidth)){if(B-(this.table.offsetWidth-z.offsetWidth)>0){this.table.style.left=(B-(this.table.offsetWidth-z.offsetWidth))+"px"}else{this.table.style.left=0}}else{this.table.style.left=B+"px"}if(this.is_ie_6){this.iframe.style.top=this.table.style.top;this.iframe.style.left=this.table.style.left}};function m(w){h.chosenColor.value=w.colorCode;h.backSample.style.backgroundColor=w.colorCode;h.foreSample.style.color=w.colorCode;if((w.hue>=195&&w.saturation>0.5)||(w.hue===0&&w.saturation===0&&w.value<0.5)||(w.hue!==0&&h.value<0.75)){w.style.borderColor="#fff"}else{w.style.borderColor="#000"}v=w.thisrow;t=w.thiscol}function i(w){if(h.value<0.5){w.style.borderColor="#fff"}else{w.style.borderColor="#000"}j=w.thisrow;g=w.thiscol;h.chosenColor.value=h.saved_cells[v][t].colorCode;h.backSample.style.backgroundColor=h.saved_cells[v][t].colorCode;h.foreSample.style.color=h.saved_cells[v][t].colorCode}function q(x,w){h.saved_cells[x][w].style.borderColor=h.saved_cells[x][w].colorCode}this.pick_color=function(){var J,K;var I=this;var Q=359/(this.side);var A=1/(this.side-1);var H=1/(this.side-1);var P=this.constrain_cb.checked;if(this.saved_cells===null){this.saved_cells=[];for(var B=0;B<this.side;B++){var x=document.createElement("tr");this.saved_cells[B]=[];for(var y=0;y<this.side;y++){var F=document.createElement("td");if(P){F.colorCode=o(r(k(Q*B,A*y,this.value)))}else{F.colorCode=o(k(Q*B,A*y,this.value))}this.saved_cells[B][y]=F;F.style.height=this.cellsize+"px";F.style.width=this.cellsize-2+"px";F.style.borderWidth="1px";F.style.borderStyle="solid";F.style.borderColor=F.colorCode;F.style.backgroundColor=F.colorCode;if(B==v&&y==t){F.style.borderColor="#000";this.chosenColor.value=F.colorCode;this.backSample.style.backgroundColor=F.colorCode;this.foreSample.style.color=F.colorCode}F.hue=Q*B;F.saturation=A*y;F.thisrow=B;F.thiscol=y;F.onmousedown=function(){c=true;I.saved_cells[v][t].style.borderColor=I.saved_cells[v][t].colorCode;m(this)};F.onmouseover=function(){if(c){m(this)}};F.onmouseout=function(){if(c){this.style.borderColor=this.colorCode}};F.ondblclick=function(){Xinha.colorPicker.remember(this.colorCode,I.savecolors);I.callback(this.colorCode);I.close()};F.appendChild(document.createTextNode(" "));F.style.cursor="pointer";x.appendChild(F);F=null}var F=document.createElement("td");F.appendChild(document.createTextNode(" "));F.style.width=this.cellsize+"px";x.appendChild(F);F=null;var F=document.createElement("td");this.saved_cells[B][y+1]=F;F.appendChild(document.createTextNode(" "));F.style.width=this.cellsize-2+"px";F.style.height=this.cellsize+"px";F.constrainedColorCode=o(r(k(0,0,H*B)));F.style.backgroundColor=F.colorCode=o(k(0,0,H*B));F.style.borderWidth="1px";F.style.borderStyle="solid";F.style.borderColor=F.colorCode;if(B==j){F.style.borderColor="black"}F.hue=Q*B;F.saturation=A*y;F.hsv_value=H*B;F.thisrow=B;F.thiscol=y+1;F.onmousedown=function(){d=true;I.saved_cells[j][g].style.borderColor=I.saved_cells[j][g].colorCode;I.value=this.hsv_value;I.pick_color();i(this)};F.onmouseover=function(){if(d){I.value=this.hsv_value;I.pick_color();i(this)}};F.onmouseout=function(){if(d){this.style.borderColor=this.colorCode}};F.style.cursor="pointer";x.appendChild(F);F=null;this.tbody.appendChild(x);x=null}var x=document.createElement("tr");this.saved_cells[B]=[];for(var y=0;y<this.side;y++){var F=document.createElement("td");if(P){F.colorCode=o(r(k(0,0,H*(this.side-y-1))))}else{F.colorCode=o(k(0,0,H*(this.side-y-1)))}this.saved_cells[B][y]=F;F.style.height=this.cellsize+"px";F.style.width=this.cellsize-2+"px";F.style.borderWidth="1px";F.style.borderStyle="solid";F.style.borderColor=F.colorCode;F.style.backgroundColor=F.colorCode;F.hue=0;F.saturation=0;F.value=H*(this.side-y-1);F.thisrow=B;F.thiscol=y;F.onmousedown=function(){c=true;I.saved_cells[v][t].style.borderColor=I.saved_cells[v][t].colorCode;m(this)};F.onmouseover=function(){if(c){m(this)}};F.onmouseout=function(){if(c){this.style.borderColor=this.colorCode}};F.ondblclick=function(){Xinha.colorPicker.remember(this.colorCode,I.savecolors);I.callback(this.colorCode);I.close()};F.appendChild(document.createTextNode(" "));F.style.cursor="pointer";x.appendChild(F);F=null}this.tbody.appendChild(x);x=null;var x=document.createElement("tr");var F=document.createElement("td");x.appendChild(F);F.colSpan=this.side+2;F.style.padding="3px";if(this.websafe){var L=document.createElement("div");var G=document.createElement("label");G.appendChild(document.createTextNode(Xinha._lc("Web Safe: ")));this.constrain_cb.onclick=function(){I.pick_color()};G.appendChild(this.constrain_cb);G.style.fontFamily="small-caption,caption,sans-serif";G.style.fontSize="x-small";L.appendChild(G);F.appendChild(L);L=null}var L=document.createElement("div");var G=document.createElement("label");G.style.fontFamily="small-caption,caption,sans-serif";G.style.fontSize="x-small";G.appendChild(document.createTextNode(Xinha._lc("Color: ")));G.appendChild(this.chosenColor);L.appendChild(G);var N=document.createElement("span");N.className="buttonColor ";N.style.fontSize="13px";N.style.width="24px";N.style.marginLeft="2px";N.style.padding="0px 4px";N.style.cursor="pointer";N.onclick=function(){Xinha.colorPicker.remember(I.chosenColor.value,I.savecolors);I.callback(I.chosenColor.value);I.close()};N.appendChild(document.createTextNode(Xinha._lc("OK")));N.align="center";L.appendChild(N);F.appendChild(L);var w=document.createElement("table");w.style.width="100%";var O=document.createElement("tbody");w.appendChild(O);var z=document.createElement("tr");O.appendChild(z);var M=document.createElement("td");z.appendChild(M);M.appendChild(this.backSample);M.style.width="50%";var S=document.createElement("td");z.appendChild(S);S.appendChild(this.foreSample);S.style.width="50%";F.appendChild(w);var R=document.createElement("div");R.style.clear="both";function E(U){var T=Xinha.is_ie;var V=document.createElement("div");V.style.width=I.cellsize+"px";V.style.height=I.cellsize+"px";V.style.margin="1px";V.style.border="1px solid black";V.style.cursor="pointer";V.style.backgroundColor=U;V.style[T?"styleFloat":"cssFloat"]="left";V.ondblclick=function(){I.callback(U);I.close()};V.onclick=function(){I.chosenColor.value=U;I.backSample.style.backgroundColor=U;I.foreSample.style.color=U};R.appendChild(V)}for(var D=0;D<Xinha.colorPicker.savedColors.length;D++){E(Xinha.colorPicker.savedColors[D])}F.appendChild(R);this.tbody.appendChild(x);document.body.appendChild(this.table);if(this.is_ie_6){if(!this.iframe){this.iframe=document.createElement("iframe");this.iframe.frameBorder=0;this.iframe.src="javascript:;";this.iframe.style.position="absolute";this.iframe.style.width=this.table.offsetWidth;this.iframe.style.height=this.table.offsetHeight;document.body.insertBefore(this.iframe,this.table)}this.iframe.style.display=""}}else{for(var B=0;B<this.side;B++){for(var y=0;y<this.side;y++){if(P){this.saved_cells[B][y].colorCode=o(r(k(Q*B,A*y,this.value)))}else{this.saved_cells[B][y].colorCode=o(k(Q*B,A*y,this.value))}this.saved_cells[B][y].style.backgroundColor=this.saved_cells[B][y].colorCode;this.saved_cells[B][y].style.borderColor=this.saved_cells[B][y].colorCode}}var C=this.saved_cells[v][t];this.chosenColor.value=C.colorCode;this.backSample.style.backgroundColor=C.colorCode;this.foreSample.style.color=C.colorCode;if((C.hue>=195&&C.saturation>0.5)||(C.hue===0&&C.saturation===0&&C.value<0.5)||(C.hue!==0&&I.value<0.75)){C.style.borderColor="#fff"}else{C.style.borderColor="#000"}}};this.close=function(){Xinha._removeEvent(document.body,"mousedown",a);this.table.style.display="none";if(this.is_ie_6){if(this.iframe){this.iframe.style.display="none"}}}};Xinha.colorPicker.savedColors=[];Xinha.colorPicker.remember=function(a,c){for(var b=Xinha.colorPicker.savedColors.length;b--;){if(Xinha.colorPicker.savedColors[b]==a){return false}}Xinha.colorPicker.savedColors.splice(0,0,a);Xinha.colorPicker.savedColors=Xinha.colorPicker.savedColors.slice(0,c);var d=new Date();d.setMonth(d.getMonth()+1);document.cookie="XinhaColorPicker="+escape(Xinha.colorPicker.savedColors.join("-"))+";expires="+d.toGMTString();return true};Xinha.colorPicker.loadColors=function(){var b=document.cookie.indexOf("XinhaColorPicker");if(b!=-1){var c=(document.cookie.indexOf("=",b)+1);var a=document.cookie.indexOf(";",b);if(a==-1){a=document.cookie.length}Xinha.colorPicker.savedColors=unescape(document.cookie.substring(c,a)).split("-")}};Xinha.colorPicker.InputBinding=function(b,c){var a=document.createElement("span");a.className="buttonColor";var d=this.chooser=document.createElement("span");d.className="chooser";if(b.value){d.style.backgroundColor=b.value}d.onmouseover=function(){d.className="chooser buttonColor-hilite"};d.onmouseout=function(){d.className="chooser"};d.appendChild(document.createTextNode("\u00a0"));a.appendChild(d);var e=document.createElement("span");e.className="nocolor";e.onmouseover=function(){e.className="nocolor buttonColor-hilite";e.style.color="#f00"};e.onmouseout=function(){e.className="nocolor";e.style.color="#000"};e.onclick=function(){b.value="";d.style.backgroundColor=""};e.appendChild(document.createTextNode("\u00d7"));a.appendChild(e);b.parentNode.insertBefore(a,b.nextSibling);Xinha._addEvent(b,"change",function(){d.style.backgroundColor=this.value});c=(c)?Xinha.cloneObject(c):{cellsize:"5px"};c.callback=(c.callback)?c.callback:function(f){d.style.backgroundColor=f;b.value=f};d.onclick=function(){var f=new Xinha.colorPicker(c);f.open("",d,b.value)};Xinha.freeLater(this,"chooser")};Xinha.colorPicker.InputBinding.prototype.setColor=function(a){this.chooser.style.backgroundColor=a};