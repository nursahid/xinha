function SaveSubmit(c){this.editor=c;this.changed=false;var b=this;var a=c.config;this.textarea=this.editor._textArea;this.image_changed=_editor_url+"plugins/SaveSubmit/img/ed_save_red.gif";this.image_unchanged=_editor_url+"plugins/SaveSubmit/img/ed_save_green.gif";a.registerButton({id:"savesubmit",tooltip:b._lc("Save"),image:this.image_unchanged,textMode:false,action:function(){b.save()}});a.addToolbarElement("savesubmit","popupeditor",-1)}SaveSubmit.prototype._lc=function(a){return Xinha._lc(a,"SaveSubmit")};SaveSubmit._pluginInfo={name:"SaveSubmit",version:"1.0",developer:"Raimund Meyer",developer_url:"http://rheinauf.de",c_owner:"Raimund Meyer",sponsor:"",sponsor_url:"",license:"htmlArea"};SaveSubmit.prototype.onGenerateOnce=function(){this.initial_html=this.editor.getInnerHTML()};SaveSubmit.prototype.onKeyPress=function(a){if(a.ctrlKey&&this.editor.getKey(a)=="s"){this.save(this.editor);Xinha._stopEvent(a);return true}else{if(!this.changed){if(this.getChanged()){this.setChanged()}return false}}};SaveSubmit.prototype.onExecCommand=function(a){if(this.changed&&a=="undo"){if(this.initial_html==this.editor.getInnerHTML()){this.setUnChanged()}return false}};SaveSubmit.prototype.onUpdateToolbar=function(){if(!this.changed){if(this.getChanged()){this.setChanged()}return false}};SaveSubmit.prototype.getChanged=function(){if(this.initial_html===null){this.initial_html=this.editor.getInnerHTML()}if(this.initial_html!=this.editor.getInnerHTML()&&this.changed==false){this.changed=true;return true}else{return false}};SaveSubmit.prototype.setChanged=function(){this.editor._toolbarObjects.savesubmit.swapImage(this.image_changed);this.editor.updateToolbar()};SaveSubmit.prototype.setUnChanged=function(){this.changed=false;this.editor._toolbarObjects.savesubmit.swapImage(this.image_unchanged)};SaveSubmit.prototype.changedReset=function(){this.initial_html=null;this.setUnChanged()};SaveSubmit.prototype.save=function(){this.buildMessage();var d=this.editor;var a=this;var f=d._textArea.form;f.onsubmit();var b,g,e="";for(var c=0;c<f.elements.length;c++){if((f.elements[c].type=="checkbox"||f.elements[c].type=="radio")&&!f.elements[c].checked){continue}e+=((c>0)?"&":"")+f.elements[c].name+"="+encodeURIComponent(f.elements[c].value)}Xinha._postback(d._textArea.form.action,e,function(h){if(h){a.setMessage(h);a.changedReset()}removeMessage=function(){a.removeMessage()};window.setTimeout("removeMessage()",1000)})};SaveSubmit.prototype.setMessage=function(c){var a=this.textarea;if(!document.getElementById("message_sub_"+a.id)){return}var b=document.getElementById("message_sub_"+a.id);b.innerHTML=Xinha._lc(c,"SaveSubmit")};SaveSubmit.prototype.removeMessage=function(){var a=this.textarea;if(!document.getElementById("message_"+a.id)){return}document.body.removeChild(document.getElementById("message_"+a.id))};SaveSubmit.prototype.buildMessage=function(){var a=this.textarea;var e=this.editor._htmlArea;var d=document.createElement("div");d.id="message_"+a.id;d.className="loading";d.style.width=e.offsetWidth+"px";d.style.left=Xinha.findPosX(e)+"px";d.style.top=(Xinha.findPosY(e)+parseInt(e.offsetHeight)/2)-50+"px";var c=document.createElement("div");c.className="loading_main";c.id="loading_main_"+a.id;c.appendChild(document.createTextNode(this._lc("Saving...")));var b=document.createElement("div");b.className="loading_sub";b.id="message_sub_"+a.id;b.appendChild(document.createTextNode(this._lc("in progress")));d.appendChild(c);d.appendChild(b);document.body.appendChild(d)};