function SuperClean(b,a){this.editor=b;var c=this;b._superclean_on=false;b.config.registerButton("superclean",this._lc("Clean up HTML"),b.imgURL("ed_superclean.gif","SuperClean"),true,function(f,g,d){c._superClean(null,d)});b.config.addToolbarElement("superclean","killword",0)}SuperClean._pluginInfo={name:"SuperClean",version:"1.0",developer:"James Sleeman, Niko Sams",developer_url:"http://www.gogo.co.nz/",c_owner:"Gogo Internet Services",license:"htmlArea",sponsor:"Gogo Internet Services",sponsor_url:"http://www.gogo.co.nz/"};SuperClean.prototype._lc=function(a){return Xinha._lc(a,"SuperClean")};SuperClean.prototype._superClean=function(opts,obj){var superclean=this;var doOK=function(){var opts=superclean._dialog.hide();var editor=superclean.editor;if(opts.word_clean){editor._wordClean()}var D=editor.getInnerHTML();for(var filter in editor.config.SuperClean.filters){if(filter=="tidy"||filter=="word_clean"){continue}if(opts[filter]){D=SuperClean.filterFunctions[filter](D,editor)}}D=D.replace(/(style|class)="\s*"/gi,"");D=D.replace(/<(font|span)\s*>/gi,"");editor.setHTML(D);if(opts.tidy){var callback=function(javascriptResponse){eval("var response = "+javascriptResponse);switch(response.action){case"setHTML":editor.setHTML(response.value);break;case"alert":alert(superclean._lc(response.value));break}};Xinha._postback(editor.config.SuperClean.tidy_handler,{content:editor.getInnerHTML()},callback)}return true};if(this.editor.config.SuperClean.show_dialog){var inputs={};this._dialog.show(inputs,doOK)}else{var editor=this.editor;var html=editor.getInnerHTML();for(var filter in editor.config.SuperClean.filters){if(filter=="tidy"){continue}html=SuperClean.filterFunctions[filter](html,editor)}html=html.replace(/(style|class)="\s*"/gi,"");html=html.replace(/<(font|span)\s*>/gi,"");editor.setHTML(html);if(editor.config.SuperClean.filters.tidy){SuperClean.filterFunctions.tidy(html,editor)}}};Xinha.Config.prototype.SuperClean={tidy_handler:_editor_url+"plugins/SuperClean/tidy.php",filters:{tidy:Xinha._lc("General tidy up and correction of some problems.","SuperClean"),word_clean:Xinha._lc("Clean bad HTML from Microsoft Word","SuperClean"),remove_faces:Xinha._lc('Remove custom typefaces (font "styles").',"SuperClean"),remove_sizes:Xinha._lc("Remove custom font sizes.","SuperClean"),remove_colors:Xinha._lc("Remove custom text colors.","SuperClean"),remove_lang:Xinha._lc("Remove lang attributes.","SuperClean"),remove_fancy_quotes:{label:Xinha._lc("Replace directional quote marks with non-directional quote marks.","SuperClean"),checked:false}},show_dialog:true};SuperClean.filterFunctions={};SuperClean.filterFunctions.remove_colors=function(a){a=a.replace(/color="?[^" >]*"?/gi,"");a=a.replace(/([^-])color:[^;}"']+;?/gi,"$1");return(a)};SuperClean.filterFunctions.remove_sizes=function(a){a=a.replace(/size="?[^" >]*"?/gi,"");a=a.replace(/font-size:[^;}"']+;?/gi,"");return(a)};SuperClean.filterFunctions.remove_faces=function(a){a=a.replace(/face="?[^" >]*"?/gi,"");a=a.replace(/font-family:[^;}"']+;?/gi,"");return(a)};SuperClean.filterFunctions.remove_lang=function(a){a=a.replace(/lang="?[^" >]*"?/gi,"");return(a)};SuperClean.filterFunctions.word_clean=function(a,b){b.setHTML(a);b._wordClean();return b.getInnerHTML()};SuperClean.filterFunctions.remove_fancy_quotes=function(a){a=a.replace(new RegExp(String.fromCharCode(8216),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8217),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8218),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8219),"g"),"'");a=a.replace(new RegExp(String.fromCharCode(8220),"g"),'"');a=a.replace(new RegExp(String.fromCharCode(8221),"g"),'"');a=a.replace(new RegExp(String.fromCharCode(8222),"g"),'"');a=a.replace(new RegExp(String.fromCharCode(8223),"g"),'"');return a};SuperClean.filterFunctions.tidy=function(html,editor){Xinha._postback(editor.config.SuperClean.tidy_handler,{content:html},function(javascriptResponse){eval(javascriptResponse)})};SuperClean.prototype.onGenerate=function(){if(this.editor.config.SuperClean.show_dialog&&!this._dialog){this._dialog=new SuperClean.Dialog(this)}if(this.editor.config.tidy_handler){this.editor.config.SuperClean.tidy_handler=this.editor.config.tidy_handler;this.editor.config.tidy_handler=null}if(!this.editor.config.SuperClean.tidy_handler&&this.editor.config.filters.tidy){this.editor.config.filters.tidy=null}var sc=this;for(var filter in this.editor.config.SuperClean.filters){if(!SuperClean.filterFunctions[filter]){var filtDetail=this.editor.config.SuperClean.filters[filter];if(typeof filtDetail.filterFunction!="undefined"){SuperClean.filterFunctions[filter]=filterFunction}else{Xinha._getback(_editor_url+"plugins/SuperClean/filters/"+filter+".js",function(func){eval("SuperClean.filterFunctions."+filter+"="+func+";");sc.onGenerate()})}return}}};SuperClean.Dialog=function(a){var b=this;this.Dialog_nxtid=0;this.SuperClean=a;this.id={};this.ready=false;this.files=false;this.html=false;this.dialog=false;this._prepareDialog()};SuperClean.Dialog.prototype._prepareDialog=function(){var g=this;var e=this.SuperClean;if(this.html==false){Xinha._getback(_editor_url+"plugins/SuperClean/dialog.html",function(h){g.html=h;g._prepareDialog()});return}var f="";for(var d in this.SuperClean.editor.config.SuperClean.filters){f+="    <div>\n";var c=this.SuperClean.editor.config.SuperClean.filters[d];if(typeof c.label=="undefined"){f+='        <input type="checkbox" name="['+d+']" id="['+d+']" checked />\n';f+='        <label for="['+d+']">'+this.SuperClean.editor.config.SuperClean.filters[d]+"</label>\n"}else{f+='        <input type="checkbox" name="['+d+']" id="['+d+']" '+(c.checked?"checked":"")+" />\n";f+='        <label for="['+d+']">'+c.label+"</label>\n"}f+="    </div>\n"}this.html=this.html.replace("<!--filters-->",f);var b=this.html;var a=this.dialog=new Xinha.Dialog(e.editor,this.html,"SuperClean");this.ready=true};SuperClean.Dialog.prototype._lc=SuperClean.prototype._lc;SuperClean.Dialog.prototype.show=function(a,c,d){if(!this.ready){var e=this;window.setTimeout(function(){e.show(a,c,d)},100);return}var b=this.dialog;var e=this;if(c){this.dialog.getElementById("ok").onclick=c}else{this.dialog.getElementById("ok").onclick=function(){e.hide()}}if(d){this.dialog.getElementById("cancel").onclick=d}else{this.dialog.getElementById("cancel").onclick=function(){e.hide()}}this.SuperClean.editor.disableToolbar(["fullscreen","SuperClean"]);this.dialog.show(a);this.dialog.onresize()};SuperClean.Dialog.prototype.hide=function(){this.SuperClean.editor.enableToolbar();return this.dialog.hide()};