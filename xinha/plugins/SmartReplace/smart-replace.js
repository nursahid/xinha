function SmartReplace(c){this.editor=c;var a=c.config;var b=this;a.registerButton({id:"smartreplace",tooltip:this._lc("SmartReplace"),image:_editor_url+"plugins/SmartReplace/img/smartquotes.gif",textMode:false,action:function(f,g,d){b.buttonPress(null,d)}});a.addToolbarElement("smartreplace","htmlmode",1)}SmartReplace._pluginInfo={name:"SmartReplace",version:"1.0",developer:"Raimund Meyer",developer_url:"http://rheinauf.de",c_owner:"Raimund Meyer",sponsor:"",sponsor_url:"",license:"htmlArea"};SmartReplace.prototype._lc=function(a){return Xinha._lc(a,"SmartReplace")};Xinha.Config.prototype.SmartReplace={defaultActive:true,quotes:null};SmartReplace.prototype.toggleActivity=function(a){if(typeof a!="undefined"){this.active=a}else{this.active=this.active?false:true}this.editor._toolbarObjects.smartreplace.state("active",this.active)};SmartReplace.prototype.onUpdateToolbar=function(){this.editor._toolbarObjects.smartreplace.state("active",this.active)};SmartReplace.prototype.onGenerate=function(){this.active=this.editor.config.SmartReplace.defaultActive;this.editor._toolbarObjects.smartreplace.state("active",this.active);var b=this;Xinha._addEvents(b.editor._doc,["keypress"],function(c){return b.keyEvent(Xinha.is_ie?b.editor._iframe.contentWindow.event:c)});var a=this.editor.config.SmartReplace.quotes;if(a&&typeof a=="object"){this.openingQuotes=a[0];this.closingQuotes=a[1];this.openingQuote=a[2];this.closingQuote=a[3]}else{this.openingQuotes=this._lc("OpeningDoubleQuotes");this.closingQuote=this._lc("ClosingSingleQuote");this.closingQuotes=this._lc("ClosingDoubleQuotes");this.openingQuote=this._lc("OpeningSingleQuote")}if(this.openingQuotes=="OpeningDoubleQuotes"){this.openingQuotes=String.fromCharCode(8220);this.closingQuotes=String.fromCharCode(8221);this.openingQuote=String.fromCharCode(8216);this.closingQuote=String.fromCharCode(8217)}};SmartReplace.prototype.keyEvent=function(d){if(!this.active){return true}var c=this.editor;var a=Xinha.is_ie?d.keyCode:d.charCode;var b=String.fromCharCode(a);if(a==32){return this.smartDash()}if(b=='"'||b=="'"){Xinha._stopEvent(d);return this.smartQuotes(b)}return true};SmartReplace.prototype.smartQuotes=function(d){if(d=="'"){var a=this.openingQuote;var b=this.closingQuote}else{var a=this.openingQuotes;var b=this.closingQuotes}var c=this.editor;var f=c.getSelection();if(Xinha.is_ie){var e=c.createRange(f);if(e.text!==""){e.text=""}e.moveStart("character",-1);if(e.text.match(/\S/)){e.moveStart("character",+1);e.text=b}else{e.moveStart("character",+1);e.text=a}}else{var e=c.createRange(f);if(!e.collapsed){c.insertNodeAtSelection(document.createTextNode(""))}if(e.startOffset>0){e.setStart(e.startContainer,e.startOffset-1)}if(e.toString().match(/[^\s\xA0]/)){e.collapse(false);c.insertNodeAtSelection(document.createTextNode(b))}else{c.insertNodeAtSelection(document.createTextNode(a))}c.getSelection().collapseToEnd()}};SmartReplace.prototype.smartDash=function(){var a=this.editor;var c=this.editor.getSelection();var b=this.editor.createRange(c);if(Xinha.is_ie){b.moveStart("character",-2);if(b.text.match(/\s-/)){b.text=" "+String.fromCharCode(8211)}}else{if(b.startOffset>1){b.setStart(b.startContainer,b.startOffset-2)}if(b.toString().match(/^ -/)){this.editor.insertNodeAtSelection(document.createTextNode(String.fromCharCode(8211)))}a.getSelection().collapseToEnd()}};SmartReplace.prototype.replaceAll=function(){var g=["&quot;",String.fromCharCode(8220),String.fromCharCode(8221),String.fromCharCode(8222),String.fromCharCode(187),String.fromCharCode(171)];var e=["'",String.fromCharCode(8216),String.fromCharCode(8217),String.fromCharCode(8218),String.fromCharCode(8250),String.fromCharCode(8249)];var c=this.editor.getHTML();var h=new RegExp("(\\s|^|>)("+g.join("|")+")(\\S)","g");c=c.replace(h,"$1"+this.openingQuotes+"$3");var b=new RegExp("(\\s|^|>)("+e.join("|")+")(\\S)","g");c=c.replace(b,"$1"+this.openingQuote+"$3");var a=new RegExp("(\\S)("+g.join("|")+")","g");c=c.replace(a,"$1"+this.closingQuotes);var f=new RegExp("(\\S)("+e.join("|")+")","g");c=c.replace(f,"$1"+this.closingQuote);var d=new RegExp("( |&nbsp;)(-)( |&nbsp;)","g");c=c.replace(d," "+String.fromCharCode(8211)+" ");this.editor.setHTML(c)};SmartReplace.prototype.dialog=function(){var a=this;var b=function(d){a.toggleActivity(d.enable);if(d.convert){a.replaceAll()}};var c=this;Dialog(_editor_url+"plugins/SmartReplace/popups/dialog.html",b,c)};SmartReplace.prototype.buttonPress=function(c,d){var b=this;if(this._dialog.dialog.rootElem.style.display!="none"){return this._dialog.hide()}var e=function(){var f=b._dialog.hide();b.toggleActivity((f.enable)?true:false);if(f.convert){b.replaceAll();b._dialog.dialog.getElementById("convert").checked=false}};var a={enable:b.active?"on":"",convert:""};this._dialog.show(a,e)};SmartReplace.prototype.onGenerateOnce=function(){if(!this._dialog){this._dialog=new SmartReplace.Dialog(this)}};SmartReplace.Dialog=function(a){this.Dialog_nxtid=0;this.mainPluginObject=a;this.id={};this.ready=false;this.files=false;this.html=false;this.dialog=false;this._prepareDialog()};SmartReplace.Dialog.prototype._prepareDialog=function(){var b=this;var a=this.mainPluginObject.editor;if(this.html==false){Xinha._getback(_editor_url+"plugins/SmartReplace/dialog.html",function(c){b.html=c;b._prepareDialog()});return}this.dialog=new Xinha.Dialog(a,this.html,"SmartReplace");this.ready=true};SmartReplace.Dialog.prototype._lc=SmartReplace.prototype._lc;SmartReplace.Dialog.prototype.show=function(a,c,d){if(!this.ready){var e=this;window.setTimeout(function(){e.show(a,c,d)},100);return}var b=this.dialog;var e=this;if(c){this.dialog.getElementById("ok").onclick=c}else{this.dialog.getElementById("ok").onclick=function(){e.hide()}}if(d){this.dialog.getElementById("cancel").onclick=d}else{this.dialog.getElementById("cancel").onclick=function(){e.hide()}}this.mainPluginObject.editor.disableToolbar(["fullscreen","smartreplace"]);this.dialog.show(a);this.dialog.onresize()};SmartReplace.Dialog.prototype.hide=function(){this.mainPluginObject.editor.enableToolbar();return this.dialog.hide()};