Xinha.loadStyle("menu.css","ContextMenu");function ContextMenu(a){this.editor=a}ContextMenu._pluginInfo={name:"ContextMenu",version:"1.0",developer:"Mihai Bazon",developer_url:"http://dynarch.com/mishoo/",c_owner:"dynarch.com",sponsor:"American Bible Society",sponsor_url:"http://www.americanbible.org",license:"htmlArea"};ContextMenu.prototype.onGenerate=function(){var a=this;var b=this.editordoc=this.editor._iframe.contentWindow.document;Xinha._addEvents(b,["contextmenu"],function(c){return a.popupMenu(Xinha.is_ie?a.editor._iframe.contentWindow.event:c)});this.currentMenu=null;this.editordoc.body.spellcheck=false};ContextMenu.prototype.getContextMenu=function(o){var j=this;var d=this.editor;var n=d.config;var b=[];var c=this.editor.plugins.TableOperations;if(c){c=c.instance}var q=d.hasSelectedText();if(!Xinha.is_gecko){if(q){b.push([Xinha._lc("Cut","ContextMenu"),function(){d.execCommand("cut")},null,n.btnList.cut[1]],[Xinha._lc("Copy","ContextMenu"),function(){d.execCommand("copy")},null,n.btnList.copy[1]]);b.push([Xinha._lc("Paste","ContextMenu"),function(){d.execCommand("paste")},null,n.btnList.paste[1]])}}var s=o;var e=[];var f=null;var m=null;var a=null;var g=null;var r=null;function h(i){c.buttonPress(d,i)}function k(x){var u=s;var t=u.parentNode;var w=d._doc.createElement("p");w.appendChild(d._doc.createElement("br"));t.insertBefore(w,x?u.nextSibling:u);var v=d._getSelection();var i=d._createRange(v);if(!Xinha.is_ie){v.removeAllRanges();i.selectNodeContents(w);i.collapse(true);v.addRange(i)}else{i.moveToElementText(w);i.collapse(true);i.select()}}for(;o;o=o.parentNode){var p=o.tagName;if(!p){continue}p=p.toLowerCase();switch(p){case"img":r=o;e.push(null,[Xinha._lc("_Image Properties...","ContextMenu"),function(){d._insertImage(r)},Xinha._lc("Show the image properties dialog","ContextMenu"),n.btnList.insertimage[1]]);break;case"a":f=o;e.push(null,[Xinha._lc("_Modify Link...","ContextMenu"),function(){d.config.btnList.createlink[3](d)},Xinha._lc("Current URL is","ContextMenu")+": "+f.href,n.btnList.createlink[1]],[Xinha._lc("Chec_k Link...","ContextMenu"),function(){window.open(f.href)},Xinha._lc("Opens this link in a new window","ContextMenu")],[Xinha._lc("_Remove Link...","ContextMenu"),function(){if(confirm(Xinha._lc("Please confirm that you want to unlink this element.","ContextMenu")+"\n"+Xinha._lc("Link points to:","ContextMenu")+" "+f.href)){while(f.firstChild){f.parentNode.insertBefore(f.firstChild,f)}f.parentNode.removeChild(f)}},Xinha._lc("Unlink the current element","ContextMenu")]);break;case"td":g=o;if(!c){break}e.push(null,[Xinha._lc("C_ell Properties...","ContextMenu"),function(){h("TO-cell-prop")},Xinha._lc("Show the Table Cell Properties dialog","ContextMenu"),n.btnList["TO-cell-prop"][1]],[Xinha._lc("Insert Cell After","ContextMenu"),function(){h("TO-cell-insert-after")},Xinha._lc("Insert Cell After","ContextMenu"),n.btnList["TO-cell-insert-after"][1]],[Xinha._lc("Insert Cell Before","ContextMenu"),function(){h("TO-cell-insert-before")},Xinha._lc("Insert Cell After","ContextMenu"),n.btnList["TO-cell-insert-before"][1]],[Xinha._lc("Delete Cell","ContextMenu"),function(){h("TO-cell-delete")},Xinha._lc("Delete Cell","ContextMenu"),n.btnList["TO-cell-delete"][1]],[Xinha._lc("Merge Cells","ContextMenu"),function(){h("TO-cell-merge")},Xinha._lc("Merge Cells","ContextMenu"),n.btnList["TO-cell-merge"][1]]);break;case"tr":a=o;if(!c){break}e.push(null,[Xinha._lc("Ro_w Properties...","ContextMenu"),function(){h("TO-row-prop")},Xinha._lc("Show the Table Row Properties dialog","ContextMenu"),n.btnList["TO-row-prop"][1]],[Xinha._lc("I_nsert Row Before","ContextMenu"),function(){h("TO-row-insert-above")},Xinha._lc("Insert a new row before the current one","ContextMenu"),n.btnList["TO-row-insert-above"][1]],[Xinha._lc("In_sert Row After","ContextMenu"),function(){h("TO-row-insert-under")},Xinha._lc("Insert a new row after the current one","ContextMenu"),n.btnList["TO-row-insert-under"][1]],[Xinha._lc("_Delete Row","ContextMenu"),function(){h("TO-row-delete")},Xinha._lc("Delete the current row","ContextMenu"),n.btnList["TO-row-delete"][1]]);break;case"table":m=o;if(!c){break}e.push(null,[Xinha._lc("_Table Properties...","ContextMenu"),function(){h("TO-table-prop")},Xinha._lc("Show the Table Properties dialog","ContextMenu"),n.btnList["TO-table-prop"][1]],[Xinha._lc("Insert _Column Before","ContextMenu"),function(){h("TO-col-insert-before")},Xinha._lc("Insert a new column before the current one","ContextMenu"),n.btnList["TO-col-insert-before"][1]],[Xinha._lc("Insert C_olumn After","ContextMenu"),function(){h("TO-col-insert-after")},Xinha._lc("Insert a new column after the current one","ContextMenu"),n.btnList["TO-col-insert-after"][1]],[Xinha._lc("De_lete Column","ContextMenu"),function(){h("TO-col-delete")},Xinha._lc("Delete the current column","ContextMenu"),n.btnList["TO-col-delete"][1]]);break;case"body":e.push(null,[Xinha._lc("Justify Left","ContextMenu"),function(){d.execCommand("justifyleft")},null,n.btnList.justifyleft[1]],[Xinha._lc("Justify Center","ContextMenu"),function(){d.execCommand("justifycenter")},null,n.btnList.justifycenter[1]],[Xinha._lc("Justify Right","ContextMenu"),function(){d.execCommand("justifyright")},null,n.btnList.justifyright[1]],[Xinha._lc("Justify Full","ContextMenu"),function(){d.execCommand("justifyfull")},null,n.btnList.justifyfull[1]]);break}}if(q&&!f){b.push(null,[Xinha._lc("Make lin_k...","ContextMenu"),function(){d.config.btnList.createlink[3](d)},Xinha._lc("Create a link","ContextMenu"),n.btnList.createlink[1]])}for(var l=0;l<e.length;++l){b.push(e[l])}if(!/html|body/i.test(s.tagName)){b.push(null,[Xinha._lc({string:"Remove the $elem Element...",replace:{elem:"&lt;"+s.tagName+"&gt;"}},"ContextMenu"),function(){if(confirm(Xinha._lc("Please confirm that you want to remove this element:","ContextMenu")+" "+s.tagName)){var i=s;var u=i.parentNode;u.removeChild(i);if(Xinha.is_gecko){if(u.tagName.toLowerCase()=="td"&&!u.hasChildNodes()){u.appendChild(d._doc.createElement("br"))}d.forceRedraw();d.focusEditor();d.updateToolbar();if(m){var t=m.style.borderCollapse;m.style.borderCollapse="collapse";m.style.borderCollapse="separate";m.style.borderCollapse=t}}}},Xinha._lc("Remove this node from the document","ContextMenu")],[Xinha._lc("Insert paragraph before","ContextMenu"),function(){k(false)},Xinha._lc("Insert a paragraph before the current node","ContextMenu")],[Xinha._lc("Insert paragraph after","ContextMenu"),function(){k(true)},Xinha._lc("Insert a paragraph after the current node","ContextMenu")])}if(!b[0]){b.shift()}return b};ContextMenu.prototype.popupMenu=function(E){var u=this;if(this.currentMenu){this.closeMenu()}function B(i){var t={x:i.offsetLeft,y:i.offsetTop};if(i.offsetParent){var h=B(i.offsetParent);t.x+=h.x;t.y+=h.y}return t}function e(i){i||(i=window.event);if(!u.currentMenu){alert(Xinha._lc("How did you get here? (Please report!)","ContextMenu"));return false}var h=Xinha.is_ie?i.srcElement:i.target;for(;h!=null&&h!=u.currentMenu;h=h.parentNode){}if(h==null){u.closeMenu()}}var r=[];function v(x){x||(x=window.event);Xinha._stopEvent(x);if(x.keyCode==27){u.closeMenu();return false}var w=String.fromCharCode(Xinha.is_ie?x.keyCode:x.charCode).toLowerCase();for(var t=r.length;--t>=0;){var h=r[t];if(h[0].toLowerCase()==w){h[1].__msh.activate()}}}u.closeMenu=function(){u.currentMenu.parentNode.removeChild(u.currentMenu);u.currentMenu=null;Xinha._removeEvent(document,"mousedown",e);Xinha._removeEvent(u.editordoc,"mousedown",e);if(r.length>0){Xinha._removeEvent(u.editordoc,"keypress",v)}if(Xinha.is_ie){u.iePopup.hide()}};var F=Xinha.is_ie?E.srcElement:E.target;var f=B(u.editor._htmlArea);var m=E.clientX+f.x;var l=E.clientY+f.y;var s;var G;if(!Xinha.is_ie){G=document}else{var a=this.iePopup=window.createPopup();G=a.document;G.open();G.write("<html><head><style type='text/css'>@import url("+_editor_url+"plugins/ContextMenu/menu.css); html, body { padding: 0px; margin: 0px; overflow: hidden; border: 0px; }</style></head><body unselectable='yes'></body></html>");G.close()}s=G.createElement("div");if(Xinha.is_ie){s.unselectable="on"}s.oncontextmenu=function(){return false};s.className="htmlarea-context-menu";if(!Xinha.is_ie){s.style.left=s.style.top="0px"}G.body.appendChild(s);var C=G.createElement("table");s.appendChild(C);C.cellSpacing=0;C.cellPadding=0;var k=G.createElement("tbody");C.appendChild(k);var d=this.getContextMenu(F);for(var z=0;z<d.length;++z){var q=d[z];var D=G.createElement("tr");k.appendChild(D);if(Xinha.is_ie){D.unselectable="on"}else{D.onmousedown=function(h){Xinha._stopEvent(h);return false}}if(!q){D.className="separator";var g=G.createElement("td");g.className="icon";var o=">";if(Xinha.is_ie){g.unselectable="on";o=" unselectable='on' style='height=1px'>&nbsp;"}g.innerHTML="<div"+o+"</div>";var c=g.cloneNode(true);c.className="label";D.appendChild(g);D.appendChild(c)}else{var j=q[0];D.className="item";D.__msh={item:D,label:j,action:q[1],tooltip:q[2]||null,icon:q[3]||null,activate:function(){u.closeMenu();u.editor.focusEditor();this.action()}};j=j.replace(/_([a-zA-Z0-9])/,"<u>$1</u>");if(j!=q[0]){r.push([RegExp.$1,D])}j=j.replace(/__/,"_");var c=G.createElement("td");if(Xinha.is_ie){c.unselectable="on"}D.appendChild(c);c.className="icon";if(D.__msh.icon){var p=Xinha.makeBtnImg(D.__msh.icon,G);c.appendChild(p)}var b=G.createElement("td");if(Xinha.is_ie){b.unselectable="on"}D.appendChild(b);b.className="label";b.innerHTML=j;D.onmouseover=function(){this.className+=" hover";u.editor._statusBarTree.innerHTML=this.__msh.tooltip||"&nbsp;"};D.onmouseout=function(){this.className="item"};D.oncontextmenu=function(h){this.__msh.activate();if(!Xinha.is_ie){Xinha._stopEvent(h)}return false};D.onmouseup=function(i){var h=(new Date()).getTime();if(h-u.timeStamp>500){this.__msh.activate()}if(!Xinha.is_ie){Xinha._stopEvent(i)}return false}}}if(!Xinha.is_ie){s.style.left=m+"px";s.style.top=l+"px"}else{this.iePopup.show(E.screenX,E.screenY,300,50);var n=s.offsetWidth;var A=s.offsetHeight;this.iePopup.show(E.screenX,E.screenY,n,A)}this.currentMenu=s;this.timeStamp=(new Date()).getTime();Xinha._addEvent(document,"mousedown",e);Xinha._addEvent(this.editordoc,"mousedown",e);if(r.length>0){Xinha._addEvent(this.editordoc,"keypress",v)}Xinha._stopEvent(E);return false};